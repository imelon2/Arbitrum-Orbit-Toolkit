import { init, ABI_NITRO_ABI_ROOT, ABI_BRIDGE_ABI_ROOT, ABI_ROOT } from "../src/config";
import { getRevertData, decodeRevertData } from "../src/modules/revertParser.m";
import { readJSONFilesInFolder } from "../src/modules/abiReader";
import { logSuccessMsg, logNullTxMsg, logErrorMsg } from "../src/utils/log";

/**
 * CLI ts-node debug/parseErrorMsg.ts
 */
async function main() {
  try {
    return decodeRevertData("0x07c266e3000000000000000000000000c8fd7e7df0d47b30eff96577385dbbf3afbfbdf7000000000000000000000000d65a6d84844314a1ec81389daa3a126d49abddbd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000003eacb30f025630857adffac9b2366f953efe4f980000000000000000000000003eacb30f025630857adffac9b2366f953efe4f9800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000002e42e567b36000000000000000000000000211028b4a438a4fc8239d51955c6d531a3ffce910000000000000000000000003eacb30f025630857adffac9b2366f953efe4f980000000000000000000000003eacb30f025630857adffac9b2366f953efe4f98000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000006644b6172676f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003444b41000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", [ABI_NITRO_ABI_ROOT,ABI_BRIDGE_ABI_ROOT,ABI_ROOT]);
    const {provider} = init("L1")
    
    const txHash = "0xde50445be66d92fa8c71f05119a7286bff8100cb374f2dc012145ac85451d09c";
    const receipt = await provider.getTransactionReceipt(txHash);

    if (receipt.status == 1) {
      console.log(receipt);
      return logSuccessMsg();
    } else if (receipt == null) {
      return logNullTxMsg();
    }

    const data = await getRevertData(txHash, provider);

    if (data == null) {
      return logNullTxMsg(txHash);
    }

    // return decodeRevertData(data, [ABI_NITRO_ABI_ROOT,ABI_BRIDGE_ABI_ROOT,ABI_ROOT]);
  } catch (error: any) {
    if (error.data == "0x") {
      const sysError = JSON.parse(error.error.body).error.message
      return logErrorMsg(error.reason, error.data,sysError,undefined);
    } else {
      throw error;
    }
  }
}

main();
